variant: fcos
version: 1.6.0
storage:
  directories:
    - path: /home/core/.config/containers/systemd
    - path: /home/core/pods/minecraft/data
  files:
    - path: /var/lib/systemd/linger/core
      mode: 0644
    - path: /home/core/.config/containers/systemd/minecraft.volume
      contents:
        inline: |
          [Volume]
          Driver=local
          Options=type=none,device=/home/core/pods/minecraft/data,o=bind
      mode: 0644
    - path: /home/core/.config/containers/systemd/minecraft.container
      contents:
        inline: |
          [Unit]
          Description=Minecraft Server
          After=network-online.target minecraft.volume
          Requires=minecraft.volume
          [Container]
          Image=docker.io/itzg/minecraft-server:java24-graalvm
          ContainerName=minecraft-server
          PublishPort=25565:25565
          Volume=minecraft.volume:/data
          Environment=EULA=TRUE
          AutoUpdate=registry
          # Security hardening - run as non-root user
          User=1000
          Group=1000
          # Logging configuration
          LogDriver=journald
          # Additional security settings
          NoNewPrivileges=true
          DropCapability=ALL
          AddCapability=NET_BIND_SERVICE
          ReadOnly=false
          # Resource limits
          MemoryLimit=2G
          CPUQuota=50%
          [Service]
          Restart=always
          [Install]
          WantedBy=multi-user.target
      mode: 0644